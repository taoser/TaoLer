<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<title>用户管理</title>
	<link rel="stylesheet" href="/static/component/pear/css/pear.css" />
</head>
<body class="pear-container">
	<div class="layui-fluid">
		<div class="layui-card">
			<div class="layui-card-body">

				<table id="addons-list" lay-filter="addons-list"></table>

				<script type="text/html" id="toolbar">
					<div class="layui-btn-group" style="padding-bottom: 10px;">
						<a type="button" class="layui-btn layui-btn-sm" lay-event="allAddons" data-url="{:url('addon.addons/index',['type'=>'onlineAddons','selector'=>'all'])}">全部</a>
						<a type="button" class="layui-btn layui-btn-sm" lay-event="freeAddons" data-url="{:url('addon.addons/index',['type'=>'onlineAddons','selector'=>'free'])}">免费</a>
						<a type="button" class="layui-btn layui-btn-sm" lay-event="payAddons" data-url="{:url('addon.addons/index',['type'=>'onlineAddons','selector'=>'pay'])}">付费</a>
						<a type="button" class="layui-btn layui-btn-normal layui-btn-sm" lay-event="installed" data-url="{:url('addon.addons/index',['type'=>'installed','selector'=>''])}">已安装</a>
					</div>
					<div class="layui-btn-group" style="padding-bottom: 10px;">
						<button class="layui-btn layui-btn-danger layui-btn-sm layuiadmin-btn-admin" data-type="add">离线安装</button>
					</div>
				</script>

				<script type="text/html" id="addons-tool">
					{{#  if(d.have_newversion === 1){ }}
						<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="install" data-url="{:url('addon.addons/upgrade')}" data-userlogin="{:url('addon.addons/userLogin')}" data-ispay="{:url('addon.addons/isPay')}"><i class="layui-icon layui-icon-edit"></i>升级</a>
					{{# } else { }}
						{{# if(d.isInstall === 1) { }}
							<a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="config" data-url="{:url('addon.addons/config')}"><i class="layui-icon layui-icon-set"></i>设置</a>
						{{# } else { }}
							<a class="layui-btn layui-btn-xs" lay-event="install" data-url="{:url('Addons/install')}" data-userlogin="{:url('addon.addons/userLogin')}" data-ispay="{:url('addon.addons/isPay')}"><i class="layui-icon layui-icon-edit"></i>安装</a>
							<select id="vers{{d.name}}" name="sss" class="layui-border" lay-ignore lay-filter="versSelect">
								{{# d.vers.forEach(function(item, index){ }}
								<option value="{{ item }}">{{ item }}</option>
								{{# }); }}
							</select>
						{{# } }}
					{{# } }}
				</script>
				<script type="text/html" id="buttonStatus">
					<input type="checkbox" name="{{d.name}}" lay-skin="switch" lay-filter="addonsStatus" lay-text="启动|禁用" {{#  if(d.status == 1){ }} checked {{#  } }} data-url="{:url('addon.addons/check')}">
				</script>
				<script type="text/html" id="addons-installed-tool">
					<a class="layui-btn layui-btn-normal layui-btn-xs" lay-event="config" data-url="{:url('addon.addons/config')}"><i class="layui-icon layui-icon-set"></i>设置</a>
					<a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="uninstall" data-url="{:url('addon.addons/uninstall')}"><i class="layui-icon layui-icon-delete"></i>卸载</a>
				</script>
			</div>
		</div>
	</div>
	{include file="public/user_login" /}
	<script src="/static/component/layui/layui.js"></script>
	<script src="/static/component/pear/pear.js"></script>
	<script>
		var addonList = "{:url('addon.Addons/index')}";
		layui.use(['addons','table','form','upload',"notify",'toast'], function(){
		  var $ = layui.jquery
		  ,table = layui.table
		  ,form = layui.form
		  ,upload = layui.upload;
		  var notify = layui.notify;
		  var toast = layui.toast;

		  form.render('select'); // 渲染所在容器内的 select 元素
		  //监听版本选择
		  form.on('select(versSelect)', function(obj){
			layer.tips(this.value + ' ' + this.name + '：'+ obj.elem.checked, obj.othis);
		  });

			//事件
			var active = {
			  add: function(){
				layer.open({
				  type: 2
				  ,title: '添加插件'
				  ,content: 'add.html'
				  ,area: ['400px', '300px']
				});
			  }
			}

		  // 启动禁用
		  form.on('switch(addonsStatus)', function(data){
			  var data = data.elem;
			  var url = $(this).data('url');
			  //执行帖子审核
			  $.post(url,{ name: data.name },function(res){
					  if(res.code === 0){
						  toast.success({title:"成功消息",message:res.msg,position: 'topRight'});
					  } else {
						  toast.error({title:"失败消息",message:res.msg,position: 'topRight'});
					  }
					  table.reloadData("addons-list",{},'deep');
				  });
			  return false;
		  });

		$('.layui-btn.layuiadmin-btn-admin').on('click', function(){
		  var type = $(this).data('type');
		  active[type] ? active[type].call(this) : '';
		});

	  });
	</script>
</body>
</html>