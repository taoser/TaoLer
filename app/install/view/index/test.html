{extend name="index/base" /}

{block name="body"}
    <div class="inside2">
        <div class="inwp cl">
            <h2>环境检测：</h2>
            <table width="100%">
                <tr>
                    <th width="25%">坏境</th>
                    <th width="25%">最低配置</th>
                    <th width="25%">当前配置</th>
                    <th width="25%">是否符合</th>
                </tr>
                <tr>
                    <td>操作系统</td>
                    <td>不限</td>
                    <td>
                        <?php echo php_uname('s'); ?>
                    </td>
                    <td class="yes">√</td>
                </tr>
                <tr>
                    <td>php版本</td>
                    <td>&gt;7.4.0</td>
                    <td>
                        <?php echo PHP_VERSION ?>
                    </td>
                    <td>
                        <?php if (version_compare(PHP_VERSION, '7.4.0', '>=')): ?>
                        <span class="yes">√</span>
                        <?php else: ?>
                        ×
                        <?php endif ?>
                    </td>
                </tr>
            </table>

            <h2>扩展检测：</h2>
            <table width="100%">
                <tr>
                    <th width="25%">坏境</th>
                    <th width="25%">最低配置</th>
                    <th width="25%">当前配置</th>
                    <th width="25%">是否符合</th>
                </tr>
                <tr>
                    <td>数据库</td>
                    <td>Mysqli</td>
                    <td><?php
                            $pdo = false;
                            if(class_exists('PDO', false))
                            {
                               if(defined('PDO::MYSQL_ATTR_USE_BUFFERED_QUERY'))
                                {
                                    echo 'PDO_MYSQL';
                                    $pdo = true;
                                }
                                else
                                {
                                    echo '不支持PDO_MYSQL';
                                }
                            }
                            else
                            {
                                echo '不支持PDO_MYSQL';
                            }
                            if(!$pdo)
                            {
                                if (function_exists('mysqli_close'))
                                {
                                    echo 'MySQLi';
                                    $pdo = true;
                                }
                            }
                        ?>
                    </td>
                    <td>
                        <?php if ($pdo): ?>
                        <span class="yes">√</span>
                        <?php else: ?>
                        ×
                        <?php endif; ?>
                    </td>

                </tr>
                <tr>
                    <td>PDO</td>
                    <td>支持</td>
                    <td>
                        <?php if(extension_loaded('pdo')): ?>
                        Yes
                        <?php else: ?>
                        No
                        <?php endif; ?>
                    </td>
                    <td>
                        <?php if(extension_loaded('pdo')): ?>
                        <span class="yes">√</span>
                        <?php else: ?>
                        ×
                        <?php endif; ?>
                    </td>
                </tr>
                <tr>
                    <td>fileinfo</td>
                    <td>支持</td>
                    <td>
                        <?php if(get_extension_funcs('fileinfo')): ?>
                        Yes
                        <?php else: ?>
                        No
                        <?php endif; ?>
                    </td>
                    <td>
                        <?php if(get_extension_funcs('fileinfo')): ?>
                        <span class="yes">√</span>
                        <?php else: ?>
                        ×
                        <?php endif; ?>
                    </td>
                </tr>
            </table>

            <h2>目录权限：</h2>
            <table width="100%">
                <tr>
                    <th width="25%">坏境</th>
                    <th width="25%">最低配置</th>
                    <th width="25%">当前配置</th>
                    <th width="25%">是否符合</th>
                </tr>
				<tr>
                    <td>app</td>
                    <td>可写</td>
                    <td>
                        <?php if (is_writable('../app')): ?> 可写
                        <?php else: ?> 不可写
                        <?php endif ?>
                    </td>
                    <td>
                        <?php if (is_writable('../app')): ?>
                        <span class="yes">√</span>
                        <?php else: ?>
                        ×
                        <?php endif ?>
                    </td>
                </tr>
				<tr>
                    <td>config</td>
                    <td>可写</td>
                    <td>
                        <?php if (is_writable('../config')): ?> 可写
                        <?php else: ?> 不可写
                        <?php endif ?>
                    </td>
                    <td>
                        <?php if (is_writable('../config')): ?>
                        <span class="yes">√</span>
                        <?php else: ?> ×
                        <?php endif ?>
                    </td>
                </tr>
				<tr>
                    <td>public</td>
                    <td>可写</td>
                    <td>
                        <?php if (is_writable('../public')): ?> 可写
                        <?php else: ?> 不可写
                        <?php endif ?>
                    </td>
                    <td>
                        <?php if (is_writable('../public')): ?>
                        <span class="yes">√</span>
                        <?php else: ?>
                        ×
                        <?php endif ?>
                    </td>
                </tr>
                <tr>
                    <td>runtime</td>
                    <td>可写</td>
                    <td>
                        <?php if (is_writable('../runtime')): ?> 可写
                        <?php else: ?> 不可写
                        <?php endif ?>
                    </td>
                    <td>
                        <?php if (is_writable('../runtime')): ?>
                        <span class="yes">√</span>
                        <?php else: ?>
                        ×
                        <?php endif ?>
                    </td>
                </tr>
				<tr>
                    <td>view</td>
                    <td>可写</td>
                    <td>
                        <?php if (is_writable('../view')): ?> 可写
                        <?php else: ?> 不可写
                        <?php endif ?>
                    </td>
                    <td>
                        <?php if (is_writable('../view')): ?>
                        <span class="yes">√</span>
                        <?php else: ?>
                        ×
                        <?php endif ?>
                    </td>
                </tr>
            </table>
            <div class="inout1">
                <a href="{:url('index/index')}">上一步</a>
            </div>
            <div class="inout2">
                <a href="javascript:;" onclick="testClick()">下一步</a>
            </div>
        </div>
    </div>
	
{/block}
{block name="script"}
<script>
        function testClick() {
            if ($('.yes').length < 10) {
                notify.error('您的配置或权限不符合要求',"vcenter");
            } else {
                location.href = "{:url('index/create')}";
            }
        }
</script>
{/block}