<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<title>TaoLer登录</title>
		<!-- 样 式 文 件 -->
		<link rel="stylesheet" href="/static/component/pear/css/pear.css" />
		<link rel="stylesheet" href="/static/admin/css/other/login.css" />
		<script src="/static/component/layui/layui.js"></script>
	</head>
    <!-- 代 码 结 构 -->
	<body background="/static/admin/images/background.svg" style="background-size: cover;">
		
		<form class="layui-form" action="javascript:void(0);">
			<div class="layui-form-item">
				<img class="logo" src="/static/admin/images/logo.png" />
				<div class="title">TaoLer Admin</div>
				<div class="desc">
					您的每一次光临，我一定记的住
				</div>
			</div>
			<div class="layui-form-item">
				<input  name="username" placeholder="账 户 : admin " lay-verify="required" hover class="layui-input"  />
			</div>
			<div class="layui-form-item">
				<input  type="password" name="password"  placeholder="密 码 : admin " lay-verify="required" hover class="layui-input"  />
			</div>
			<div class="layui-form-item">
				<input  type="text" name="captcha"  placeholder="验证码 : "  hover  lay-verify="required" class="code layui-input layui-input-inline"  />
				<img src="{:captcha_src()}" class="codeImage" style="width:120px;" id="captcha"/>
			</div>
			<div class="layui-form-item">
				<input type="checkbox" name="remember" title="记住密码" lay-skin="primary" checked>
			</div>
			<div class="layui-form-item">
				<button type="button" class="pear-btn pear-btn-success login" lay-submit lay-filter="login" id="login-submit">
					登 入
				</button>
			</div>
		</form>
		
		<!-- 资 源 引 入 -->
		
		<script src="/static/component/pear/pear.js"></script>
		<script>
			layui.use(['form', 'button', 'popup'], function() {
				let $ = layui.jquery;
				var form = layui.form;
				var button = layui.button;
				var popup = layui.popup;

				//回车登陆
				$(document).keydown(function(e){
					if(e.keyCode == 13){
						$("#login-submit").click()
					}
				})
				
                // 登 录 提 交
				form.on('submit(login)', function(data) {
					//请求登入接口
					$.ajax({
						type: "post"
						,url: "{:url('admin.login/signin')}"
						,data: data.field
						,success: function(res){
							if(res.code === 0){
									
								//请求成功后，写入 access_token
								if(res.data.token) {
									layui.data('taoler-admin', {
										key: 'token',
										value: res.data.token
									});
								}
					         
								//登入成功的提示与跳转
								popup.success("登录成功", function() {
									location.href = res.data.url
								})

							} else {
								layer.open({title:'登陆失败', content:res.msg, icon:5, anim:6});
								layui.jquery('#captcha').attr('src', '{:captcha_src()}?' + Math.random());
							}

						}
					});
					
					/// 验证
					
					/// 登录
					
					/// 动画
					// button.load({
					// 	elem: '.login',
					// 	time: 1500,
					// 	done: function() {
					// 		popup.success("登录成功", function() {
					// 			location.href = "index.html"
					// 		});
					// 	}
					// })
					return false;
				});

				//更换图形验证码
				$('#captcha').on('click', function(){
					var othis = $(this);
					this.src = '/captcha?t='+ new Date().getTime()
				});

			})
		</script>

	</body>
</html>
